name: Multi-Language Examples

# Comprehensive workflow demonstrating integration with various languages and technologies
on:
  workflow_dispatch:
  push:
    paths:
      - 'examples/multi-lang/**'
      - '.github/workflows/multi-language-examples.yml'

permissions:
  contents: read

jobs:
  # JSON validation and processing
  json-validation:
    name: JSON Configuration Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - name: Validate JSON files
        run: |
          echo "Validating JSON configuration files..."
          for file in $(find . -name "*.json" -type f); do
            echo "Checking $file"
            python3 -m json.tool "$file" > /dev/null || exit 1
          done
          echo "All JSON files are valid"

  # HTML documentation generation
  html-docs:
    name: HTML Documentation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - uses: astral-sh/setup-uv@v7
        with:
          enable-cache: true
          version: 0.9.5
      
      - name: Install dependencies
        run: uv sync --frozen --all-extras --python 3.10
      
      - name: Generate HTML documentation
        run: |
          echo "Generating HTML documentation..."
          uv run mkdocs build --strict

  # PowerShell scripts for Windows
  powershell-scripts:
    name: PowerShell Scripts
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v5
      
      - name: Run PowerShell examples
        shell: pwsh
        run: |
          Write-Host "Running PowerShell examples..."
          # Example: Test PowerShell script execution
          $PSVersionTable.PSVersion
          Write-Host "PowerShell environment ready"

  # Docker containerization
  docker-build:
    name: Docker Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build Docker image
        run: |
          echo "Building Docker image for MCP Python SDK..."
          cat > Dockerfile.example << 'EOF'
          FROM python:3.10-slim
          WORKDIR /app
          COPY pyproject.toml uv.lock ./
          COPY src/ ./src/
          RUN pip install uv && uv sync --frozen
          CMD ["python", "-m", "mcp"]
          EOF
          docker build -f Dockerfile.example -t mcp-python-sdk:example .
          docker images

  # Python (main language - already tested in shared.yml)
  python-integration:
    name: Python Integration Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - uses: astral-sh/setup-uv@v7
        with:
          enable-cache: true
          version: 0.9.5
      
      - name: Install and test Python package
        run: |
          uv sync --frozen --all-extras --python 3.10
          uv run pytest tests/ -v --maxfail=5

  # Ruby integration example
  ruby-example:
    name: Ruby Integration
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
      
      - name: Ruby example
        run: |
          echo "Ruby integration example..."
          ruby -e "puts 'Ruby version: ' + RUBY_VERSION"
          # Example of calling Python MCP from Ruby (if needed)
          cat > example.rb << 'EOF'
          # Example Ruby script that could interact with MCP
          puts "MCP Integration from Ruby"
          puts "This demonstrates cross-language integration"
          EOF
          ruby example.rb

  # Kotlin/JVM example
  kotlin-example:
    name: Kotlin/JVM Integration
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - name: Kotlin example
        run: |
          echo "Kotlin/JVM integration example..."
          java -version
          # Example of how Kotlin could interact with MCP Python SDK
          cat > Example.kt << 'EOF'
          fun main() {
              println("Kotlin MCP Integration Example")
              println("This demonstrates JVM integration with Python MCP SDK")
              // Here you could use ProcessBuilder to call Python MCP commands
          }
          EOF
          cat Example.kt

  # Binary artifact handling
  binary-artifacts:
    name: Binary Artifacts
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      
      - name: Handle binary artifacts
        run: |
          echo "Demonstrating binary artifact handling..."
          # Create example binary artifact
          echo "Binary content" | gzip > example.bin.gz
          ls -lh example.bin.gz
          file example.bin.gz

  # Cross-platform summary
  integration-summary:
    name: Integration Summary
    runs-on: ubuntu-latest
    needs: [json-validation, html-docs, powershell-scripts, docker-build, python-integration, ruby-example, kotlin-example, binary-artifacts]
    steps:
      - name: Summary
        run: |
          echo "âœ… All multi-language integration checks passed!"
          echo "Validated technologies:"
          echo "  - JSON configuration"
          echo "  - HTML documentation"
          echo "  - PowerShell scripts"
          echo "  - Docker containers"
          echo "  - Python (primary)"
          echo "  - Ruby"
          echo "  - Kotlin/JVM"
          echo "  - Binary artifacts"
